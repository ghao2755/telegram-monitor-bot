# Telegram监控机器人

## 项目简介
这是一个功能强大的Telegram群组监控机器人，基于Node.js和Telegraf框架开发，可以帮助您监控多个群组的消息，应用自定义规则进行处理，并转发到指定的目标群组。

## 功能特点

### 1. 核心功能
- 🔍 **多群组监控**：同时监控多个源群组的消息
- 📝 **智能规则系统**：支持全局规则和群组专属规则
- 📤 **消息转发**：将处理后的消息转发到目标群组
- 📌 **智能置顶**：根据规则自动置顶重要消息
- 🎯 **群组管理**：添加、删除和配置监控群组

### 2. 高级功能
- ⚙️ **完整的设置面板**：通过交互式按钮进行配置
- 🔄 **定时检查**：自动定期检查群组状态
- 🛠️ **系统自检**：自动检测和修复系统问题
- 💾 **数据备份**：支持配置和数据的备份与恢复
- 📊 **状态监控**：实时查看系统状态和统计信息
- 🌐 **多语言支持**：支持中英文界面

### 3. 用户体验优化
- 🎯 **响应式设计**：适配不同设备屏幕
- 🔔 **实时反馈**：操作结果即时通知
- 📚 **内置帮助**：提供详细的使用指南
- 🚨 **异常告警**：系统异常时通知管理员

## 安装与配置

### 环境要求
- Node.js 14.0 或更高版本
- npm 6.0 或更高版本
- 一个Telegram机器人Token（通过@BotFather获取）

### 安装步骤

1. **克隆或下载项目代码**
   ```bash
   git clone <项目仓库地址>
   cd telegram-monitor-bot
   ```

2. **安装依赖**
   ```bash
   npm install
   ```

3. **配置环境变量**
   复制`.env.example`文件并命名为`.env`，然后编辑文件：
   ```bash
   cp .env.example .env
   nano .env
   ```
   在文件中填入以下信息：
   ```
   BOT_TOKEN=你的机器人token
   ADMIN_IDS=管理员ID列表，用逗号分隔
   NODE_ENV=production
   ```

4. **启动机器人**
   ```bash
   npm start
   ```
   开发环境下可以使用：
   ```bash
   npm run dev
   ```

## 使用指南

### 基本使用
1. 向机器人发送`/start`命令打开控制面板
2. 使用按钮导航到不同的功能模块
3. 配置源群组、目标群组和规则
4. 启用监控功能

### 功能模块说明

#### 1. 状态仪表板
显示机器人的当前状态、运行时间、群组数量、规则数量等信息。

#### 2. 群组管理
- 添加监控群组（源群组）
- 设置目标群组
- 查看群组列表和状态
- 配置群组专属规则

#### 3. 规则管理
- 添加全局规则
- 管理群组专属规则
- 测试规则效果
- 导入/导出规则配置

#### 4. 置顶管理
- 启用/禁用置顶功能
- 配置哪些群组启用置顶
- 查看置顶状态统计

#### 5. 系统自检
- 运行系统自检
- 自动修复常见问题
- 生成系统报告

#### 6. 设置
- 调整检查间隔
- 管理管理员列表
- 备份和恢复配置

### 规则设置
规则采用`关键词=替换内容`的格式，可以使用正则表达式：
- 普通文本：`关键词=替换内容`
- 正则表达式：`/关键词/=替换内容`

例如：
- `你好=您好`
- `/spam|垃圾/=***`
- `/\d{11}/=***`（替换11位数字）

## 高级配置

### 定时检查
默认情况下，机器人每5分钟检查一次群组状态。您可以在设置中调整这个间隔。

### 群组专属规则优先级
- 群组专属规则优先于全局规则
- 相同关键词时，群组规则会覆盖全局规则
- 可以配置是否继承全局规则

### 智能置顶策略
系统会根据以下条件决定是否置顶消息：
- 消息是否包含指定的关键词（如"重要通知"、"紧急"等）
- 消息的重要性评估
- 最近的置顶频率（避免频繁置顶）

## 维护与管理

### 数据备份
项目提供了备份脚本，可以定期备份您的配置数据：
```bash
node scripts/backup.js
```

### 数据恢复
如果需要恢复数据，可以使用恢复脚本：
```bash
node scripts/restore.js
```

### 日志查看
机器人运行时会在控制台输出日志信息，您可以通过以下方式查看：
```bash
# 开发环境
npm run dev

# 生产环境（使用pm2）
pm2 logs telegram-monitor-bot
```

## 常见问题解答

### Q: 机器人没有响应我的命令
A: 请检查以下几点：
1. 您是否是管理员（ADMIN_IDS中包含您的用户ID）
2. 机器人是否已经启动
3. BOT_TOKEN是否正确设置

### Q: 消息没有被正确转发
A: 请检查以下几点：
1. 源群组和目标群组是否都已启用
2. 机器人是否有足够的权限（在目标群组中需要有发送消息的权限）
3. 规则是否正确设置

### Q: 如何获取群组ID？
A: 可以通过以下方式获取群组ID：
1. 在群组中添加@userinfobot机器人，它会告诉您群组的ID
2. 在机器人日志中查找群组ID

### Q: 如何修改检查间隔？
A: 在控制面板的"设置"中，选择"设置检查间隔"，然后输入新的间隔时间（分钟）。

## 故障排除

### 机器人无法启动
- 检查.env文件中的BOT_TOKEN是否正确
- 确保Node.js版本符合要求
- 查看控制台输出的错误信息

### 消息处理失败
- 检查规则格式是否正确，特别是正则表达式
- 查看机器人是否有足够的权限
- 检查目标群组是否存在且可用

### 置顶功能不工作
- 检查目标群组的置顶权限是否已启用
- 确保机器人在目标群组中有置顶消息的权限
- 检查置顶规则是否正确配置

## 贡献指南
欢迎对项目进行贡献！如果您有任何想法或改进，请提交Issue或Pull Request。

### 开发环境设置
1. 克隆项目代码
2. 安装依赖：`npm install`
3. 安装开发依赖：`npm install --save-dev nodemon`
4. 启动开发服务器：`npm run dev`

### 代码规范
- 遵循JavaScript标准规范
- 函数和变量命名清晰明了
- 添加适当的注释
- 提交前进行测试

## 许可证
本项目采用MIT许可证。

## 更新日志

### v1.0.0 (2024-01-15)
- 初始版本发布
- 实现核心监控和转发功能
- 添加规则系统
- 实现基本的用户界面

## 联系与支持
如果您在使用过程中遇到问题，请提交Issue或联系项目维护者。

---

祝您使用愉快！🚀